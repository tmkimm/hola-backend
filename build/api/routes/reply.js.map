{"version":3,"file":"reply.js","sourceRoot":"/","sources":["api/routes/reply.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,mCAAkE;AAClE,qCAAiC;AACjC,8DAA6D;AAE7D,8CAA0D;AAC1D,8CAAoD;AACpD,6DAA4D;AAC5D,0CAAsD;AACtD,0DAA8E;AAE9E,IAAM,KAAK,GAAG,IAAA,gBAAM,GAAE,CAAC;AAEvB,mBAAe,UAAC,GAAW;IACzB;;;;;;;QAOI;IACJ,GAAG,CAAC,GAAG,CAAC,gBAAgB,EAAE,KAAK,CAAC,CAAC;IAEjC,SAAS;IACT,KAAK,CAAC,IAAI,CACR,GAAG,EACH,0BAAkB,EAClB,6BAAa,EACb,IAAA,qCAAiB,EAAC,UAAO,GAAY,EAAE,GAAa,EAAE,IAAkB;;;;;oBAChE,KAAiC,GAAG,CAAC,IAAI,EAAvC,MAAM,YAAA,EAAE,SAAS,eAAA,EAAE,OAAO,aAAA,CAAc;oBAC1C,QAAQ,GAAK,GAAG,CAAC,IAAI,SAAb,CAAc;oBACf,MAAM,GAAK,GAAG,CAAC,IAAa,IAAtB,CAAuB;oBAC1C,IAAI,CAAC,QAAQ;wBAAE,QAAQ,GAAG,oBAAK,CAAC;oBAC1B,oBAAoB,GAAG,IAAI,oBAAY,CAAC,WAAS,EAAE,2BAAiB,CAAC,CAAC;oBAC/D,qBAAM,oBAAoB,CAAC,aAAa,CAAC,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,QAAQ,CAAC,EAAA;;oBAA7F,IAAI,GAAG,SAAsF;oBAEnG,sBAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,EAAC;;;SACnC,CAAC,CACH,CAAC;IAEF,SAAS;IACT,KAAK,CAAC,KAAK,CACT,MAAM,EACN,0BAAkB,EAClB,IAAA,qCAAiB,EAAC,UAAO,GAAY,EAAE,GAAa,EAAE,IAAkB;;;;;oBAChE,UAAU,GAAG,GAAG,CAAC,IAAI,CAAC;oBAC5B,UAAU,CAAC,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC;oBAClB,WAAW,GAAK,GAAG,CAAC,IAAa,IAAtB,CAAuB;oBAEzC,oBAAoB,GAAG,IAAI,oBAAY,CAAC,WAAS,EAAE,2BAAiB,CAAC,CAAC;oBAC5D,qBAAM,oBAAoB,CAAC,WAAW,CAAC,UAAU,EAAE,WAAW,CAAC,EAAA;;oBAAzE,OAAO,GAAG,SAA+D;oBAE/E,sBAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,EAAC;;;SACtC,CAAC,CACH,CAAC;IACF,SAAS;IACT,KAAK,CAAC,MAAM,CACV,MAAM,EACN,0BAAkB,EAClB,IAAA,qCAAiB,EAAC,UAAO,GAAY,EAAE,GAAa,EAAE,IAAkB;;;;;oBAChE,OAAO,GAAG,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC;oBACjB,MAAM,GAAK,GAAG,CAAC,IAAa,IAAtB,CAAuB;oBAEpC,oBAAoB,GAAG,IAAI,oBAAY,CAAC,WAAS,EAAE,2BAAiB,CAAC,CAAC;oBAC5E,qBAAM,oBAAoB,CAAC,WAAW,CAAC,gBAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,MAAM,CAAC,EAAA;;oBAAvE,SAAuE,CAAC;oBAExE,sBAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,EAAC;;;SAC/B,CAAC,CACH,CAAC;AACJ,CAAC,EAAC","sourcesContent":["import { Router, Request, Response, NextFunction } from 'express';\r\nimport { Types } from 'mongoose';\r\nimport { isPostIdValid } from '../middlewares/isPostIdValid';\r\nimport { IUser } from '../../models/User';\r\nimport { isAccessTokenValid } from '../middlewares/index';\r\nimport { ReplyService } from '../../services/index';\r\nimport { asyncErrorWrapper } from '../../asyncErrorWrapper';\r\nimport { Post as PostModel } from '../../models/Post';\r\nimport { Notification as NotificationModel } from '../../models/Notification';\r\n\r\nconst route = Router();\r\n\r\nexport default (app: Router) => {\r\n  /*\r\n    대댓글에 관련된 Router를 정의한다.\r\n    등록 / 수정 / 삭제하려는 사용자의 정보는 Access Token을 이용하여 처리한다.\r\n\r\n    # POST /posts/replies : 신규 대댓글 등록\r\n    # PATCH /posts/replies/:id : 대댓글 정보 수정\r\n    # DELETE /posts/replies/:id : 대댓글 삭제\r\n    */\r\n  app.use('/posts/replies', route);\r\n\r\n  // 대댓글 등록\r\n  route.post(\r\n    '/',\r\n    isAccessTokenValid,\r\n    isPostIdValid,\r\n    asyncErrorWrapper(async (req: Request, res: Response, next: NextFunction) => {\r\n      const { postId, commentId, content } = req.body;\r\n      let { nickName } = req.body;\r\n      const { _id: userId } = req.user as IUser;\r\n      if (!nickName) nickName = `사용자`;\r\n      const ReplyServiceInstance = new ReplyService(PostModel, NotificationModel);\r\n      const post = await ReplyServiceInstance.registerReply(userId, postId, commentId, content, nickName);\r\n\r\n      return res.status(201).json(post);\r\n    }),\r\n  );\r\n\r\n  // 대댓글 수정\r\n  route.patch(\r\n    '/:id',\r\n    isAccessTokenValid,\r\n    asyncErrorWrapper(async (req: Request, res: Response, next: NextFunction) => {\r\n      const commentDTO = req.body;\r\n      commentDTO._id = req.params.id;\r\n      const { _id: tokenUserId } = req.user as IUser;\r\n\r\n      const ReplyServiceInstance = new ReplyService(PostModel, NotificationModel);\r\n      const comment = await ReplyServiceInstance.modifyReply(commentDTO, tokenUserId);\r\n\r\n      return res.status(200).json(comment);\r\n    }),\r\n  );\r\n  // 대댓글 삭제\r\n  route.delete(\r\n    '/:id',\r\n    isAccessTokenValid,\r\n    asyncErrorWrapper(async (req: Request, res: Response, next: NextFunction) => {\r\n      const replyId = req.params.id;\r\n      const { _id: userId } = req.user as IUser;\r\n\r\n      const ReplyServiceInstance = new ReplyService(PostModel, NotificationModel);\r\n      await ReplyServiceInstance.deleteReply(Types.ObjectId(replyId), userId);\r\n\r\n      return res.status(204).json();\r\n    }),\r\n  );\r\n};\r\n"]}