{"version":3,"file":"autoSignUp.js","sourceRoot":"/","sources":["api/middlewares/autoSignUp.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,0CAAyC;AACzC,6DAA4D;AAC5D,kEAA4C;AAE5C,uBAAuB;AACvB,eAAe;AACf,eAAe;AACf,2BAA2B;AAC3B,IAAM,UAAU,GAAG,IAAA,qCAAiB,EAAC,UAAO,GAAY,EAAE,GAAa,EAAE,IAAkB;;;;;gBACzF,IAAI,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO;oBAAE,MAAM,IAAI,qBAAW,CAAC,YAAY,EAAE,GAAG,EAAE,4BAA4B,CAAC,CAAC;gBAE9F,qBAAM,WAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,EAAA;;gBAAjD,IAAI,GAAG,SAA0C;qBACnD,CAAC,IAAI,EAAL,wBAAK;gBACS,qBAAM,WAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,EAAA;;gBAArC,OAAO,GAAG,SAA2B;gBAC3C,sBAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;wBAC1B,GAAG,EAAE,OAAO,CAAC,GAAG;wBAChB,YAAY,EAAE,KAAK;wBACnB,OAAO,EAAE,kBAAkB;qBAC5B,CAAC,EAAC;;gBAEL,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;oBAClB,sBAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;4BAC1B,GAAG,EAAE,IAAI,CAAC,GAAG;4BACb,YAAY,EAAE,KAAK;4BACnB,OAAO,EAAE,kBAAkB;yBAC5B,CAAC,EAAC;iBACJ;gBACD,IAAI,EAAE,CAAC;;;;KACR,CAAC,CAAC;AAEM,gCAAU","sourcesContent":["import { Request, Response, NextFunction } from 'express';\nimport { User } from '../../models/User';\nimport { asyncErrorWrapper } from '../../asyncErrorWrapper';\nimport CustomError from '../../CustomError';\n\n// 로그인 시 회원가입 여부를 판단한다.\n// loginSuccess\n// true: 로그인 완료\n// false: 로그인 실패. 회원 가입 필요.\nconst autoSignUp = asyncErrorWrapper(async (req: Request, res: Response, next: NextFunction) => {\n  if (!req.user || !req.user.idToken) throw new CustomError('OauthError', 400, 'Oauth parameter is Invalid');\n\n  const user = await User.findByIdToken(req.user.idToken);\n  if (!user) {\n    const newUser = await User.create(req.user);\n    return res.status(200).json({\n      _id: newUser._id,\n      loginSuccess: false,\n      message: '회원 가입을 진행해야 합니다.',\n    });\n  }\n  if (!user.nickName) {\n    return res.status(200).json({\n      _id: user._id,\n      loginSuccess: false,\n      message: '회원 가입을 진행해야 합니다.',\n    });\n  }\n  next();\n});\n\nexport { autoSignUp };\n"]}