{"version":3,"file":"isAccessTokenValid.js","sourceRoot":"/","sources":["api/middlewares/isAccessTokenValid.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,kEAA4C;AAC5C,6DAA4D;AAC5D,0CAAyC;AACzC,wCAAiE;AAEjE,2BAA2B;AAC3B,IAAM,kBAAkB,GAAG,IAAA,qCAAiB,EAAC,UAAgB,GAAY,EAAE,GAAa,EAAE,IAAkB;;;;;;yBACtG,CAAA,GAAG,CAAC,OAAO,CAAC,aAAa,IAAI,GAAG,CAAC,OAAO,CAAC,aAAa,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAA,EAA3E,wBAA2E;oBACvE,KAAK,GAAG,GAAG,CAAC,OAAO,CAAC,aAAa,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;oBAClC,qBAAM,IAAA,eAAS,EAAC,KAAK,CAAC,EAAA;;oBAApC,WAAW,GAAG,SAAsB;oBAC1C,IAAI,CAAC,IAAA,wBAAkB,EAAC,WAAW,CAAC;wBAAE,MAAM,IAAI,qBAAW,CAAC,mBAAmB,EAAE,GAAG,EAAE,eAAe,CAAC,CAAC;oBAE1F,qBAAM,WAAI,CAAC,aAAa,CAAC,WAAW,CAAC,OAAO,CAAC,EAAA;;oBAApD,IAAI,GAAG,SAA6C;oBAC1D,IAAI,CAAC,IAAI,EAAE;wBACT,MAAM,IAAI,qBAAW,CAAC,mBAAmB,EAAE,GAAG,EAAE,gBAAgB,CAAC,CAAC;qBACnE;yBAAM;wBACL,GAAG,CAAC,IAAI,GAAG;4BACT,GAAG,EAAE,IAAI,CAAC,GAAG;4BACb,QAAQ,EAAE,IAAI,CAAC,QAAQ;4BACvB,SAAS,EAAE,IAAI,CAAC,SAAS;yBAC1B,CAAC;qBACH;oBACD,IAAI,EAAE,CAAC;;wBAEP,MAAM,IAAI,qBAAW,CAAC,mBAAmB,EAAE,GAAG,EAAE,iBAAiB,CAAC,CAAC;;;;;CAEtE,CAAC,CAAC;AACM,gDAAkB","sourcesContent":["import { NextFunction, Request, Response } from 'express';\nimport CustomError from '../../CustomError';\nimport { asyncErrorWrapper } from '../../asyncErrorWrapper';\nimport { User } from '../../models/User';\nimport { isValidAccessToken, verifyJWT } from '../../utills/jwt';\n\n// Access Token이 유효한지 확인한다.\nconst isAccessTokenValid = asyncErrorWrapper(async function (req: Request, res: Response, next: NextFunction) {\n  if (req.headers.authorization && req.headers.authorization.startsWith('Bearer')) {\n    const token = req.headers.authorization.split(' ')[1];\n    const decodedUser = await verifyJWT(token);\n    if (!isValidAccessToken(decodedUser)) throw new CustomError('JsonWebTokenError', 401, 'Invaild Token');\n\n    const user = await User.findByIdToken(decodedUser.idToken);\n    if (!user) {\n      throw new CustomError('JsonWebTokenError', 401, 'User not found');\n    } else {\n      req.user = {\n        _id: user._id,\n        nickName: user.nickName,\n        tokenType: user.tokenType,\n      };\n    }\n    next();\n  } else {\n    throw new CustomError('JsonWebTokenError', 401, 'Token not found');\n  }\n});\nexport { isAccessTokenValid };\n"]}