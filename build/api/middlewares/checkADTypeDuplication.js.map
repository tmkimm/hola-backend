{"version":3,"file":"checkADTypeDuplication.js","sourceRoot":"/","sources":["api/middlewares/checkADTypeDuplication.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,sDAAgC;AAChC,kEAA4C;AAC5C,6DAA4D;AAC5D,4DAAmF;AAEnF,iCAAiC;AACjC,IAAM,sBAAsB,GAAG,IAAA,qCAAiB,EAAC,UAAO,GAAY,EAAE,GAAa,EAAE,IAAkB;;;;;gBACrG,IAAI,CAAC,CAAC,YAAY,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,mBAAmB,IAAI,GAAG,CAAC,IAAI,CAAC,EAAE;oBACrE,MAAM,IAAI,qBAAW,CAAC,qBAAqB,EAAE,GAAG,EAAE,qBAAqB,CAAC,CAAC;iBAC1E;gBAEK,UAAU,GAAG,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC;gBACjC,iBAAiB,GAAG,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC;gBAC7C,QAAQ,GAAK,kBAAQ,CAAC,KAAK,SAAnB,CAAoB;gBAEpC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAU,CAAC;oBAAE,MAAM,IAAI,qBAAW,CAAC,eAAe,EAAE,GAAG,EAAE,wBAAwB,CAAC,CAAC;gBAEpE,qBAAM,6BAAa,CAAC,uBAAuB,CAAC,UAAU,EAAE,iBAAiB,CAAC,EAAA;;gBAAzG,EAAE,GAA6B,SAA0E;gBAC/G,IAAI,EAAE,IAAI,EAAE,CAAC,MAAM,GAAG,CAAC,EAAE;oBACvB,MAAM,IAAI,qBAAW,CAAC,wBAAwB,EAAE,GAAG,EAAE,iDAAiD,CAAC,CAAC;iBACzG;gBACD,IAAI,EAAE,CAAC;;;;KACR,CAAC,CAAC;AAEM,wDAAsB","sourcesContent":["import { NextFunction, Request, Response } from 'express';\nimport mongoose from 'mongoose';\nimport CustomError from '../../CustomError';\nimport { asyncErrorWrapper } from '../../asyncErrorWrapper';\nimport { Advertisement, IAdvertisementDocument } from '../../models/Advertisement';\n\n// 광고 등록 시 캠페인에 같은 유형의 광고가 있는지 체크\nconst checkADTypeDuplication = asyncErrorWrapper(async (req: Request, res: Response, next: NextFunction) => {\n  if (!('campaignId' in req.body) || !('advertisementType' in req.body)) {\n    throw new CustomError('ContentInvaildError', 400, 'ContentInvaildError');\n  }\n\n  const campaignId = req.body.campaignId;\n  const advertisementType = req.body.advertisementType;\n  const { ObjectId } = mongoose.Types;\n\n  if (!ObjectId.isValid(campaignId)) throw new CustomError('NotFoundError', 404, 'Campaign Id is Invalid');\n\n  const ad: IAdvertisementDocument[] = await Advertisement.findAdvertisementByType(campaignId, advertisementType);\n  if (ad && ad.length > 0) {\n    throw new CustomError('DuplicationADTypeError', 400, 'The campaign advertisement type already exists.');\n  }\n  next();\n});\n\nexport { checkADTypeDuplication };\n"]}