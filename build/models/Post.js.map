{"version":3,"file":"Post.js","sourceRoot":"/","sources":["models/Post.ts"],"names":[],"mappings":"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","sourcesContent":["import { Model, Schema, model, Types, Document } from 'mongoose';\r\nimport CustomError from '../CustomError';\r\n// eslint-disable-next-line import/no-unresolved\r\nimport { studyOrProjectCode, onlineOrOfflineCode, recruitsCode, expectedPeriodCode } from '../CommonCode';\r\n// 대댓글\r\nexport interface IReply {\r\n  contnet: string;\r\n  author: Types.ObjectId;\r\n}\r\n/**\r\n * @swagger\r\n *  components:\r\n *  schemas:\r\n *   Post:\r\n *     properties:\r\n *      _id:\r\n *        type: string\r\n *        description: 글 ID\r\n *        example: '6355eee637ad670014118738'\r\n *      author:\r\n *        type: string\r\n *        description: 글 등록자 정보\r\n *        example: '634e1a1537ad67001410d1f4'\r\n *      language:\r\n *        type: array\r\n *        items:\r\n *          type: string\r\n *        description: 사용 언어\r\n *        example:\r\n *          - react\r\n *          - java\r\n *      title:\r\n *        type: string\r\n *        description: 제목\r\n *      content:\r\n *        type: string\r\n *        description: 내용\r\n *      isDeleted:\r\n *        type: boolean\r\n *        description: 삭제 여부\r\n *      isClosed:\r\n *        type: boolean\r\n *        description: 마감 여부\r\n *      views:\r\n *        type: number\r\n *        description: 조회수\r\n *        example: 219\r\n *      likes:\r\n *        type: array\r\n *        description: 관심 등록한 사용자 리스트\r\n *        items:\r\n *          type: string\r\n *        example:\r\n *          - '634e1a1537ad67001410d1f4'\r\n *          - '61063a70ed4b420bbcfa0b4b'\r\n *      totalLikes:\r\n *        type: number\r\n *        description: 관심 등록 수\r\n *        example: 2\r\n *      type:\r\n *        type: string\r\n *        description: '모집 구분(1 : 프로젝트, 2: 스터디)'\r\n *        example: '1'\r\n *      recruits:\r\n *        type: string\r\n *        description: '모집인원(und: 인원 미정, 1, 2, 3, mo: 10명 이상)'\r\n *        example: 'und'\r\n *      onlineOrOffline:\r\n *        type: string\r\n *        description: '진행방식(on: 온라인/ off: 오프라인)'\r\n *        example: 'on'\r\n *      contactType:\r\n *        type: string\r\n *        description: '연락방법(ok: 오픈 카카오톡, em: 이메일, pk: 개인 카카오톡, gf: 구글폼)'\r\n *        example: 'em'\r\n *      contactPoint:\r\n *        type: string\r\n *        description: '연락링크'\r\n *        example: 'https://open.kakao.com/o/sKdsLWGe'\r\n *      expectedPeriod:\r\n *        type: string\r\n *        description: '예상 진행기간(und: 기간 미정, 1, 2, 3, mo: 장기)'\r\n *        example: '3'\r\n *      positions:\r\n *        type: array\r\n *        description: '포지션(FE: 프론트엔드, BE: 백엔드, DE: 디자이너, IOS: IOS, AND: 안드로이드, DEVOPS: DevOps, PM)'\r\n *        items:\r\n *          type: string\r\n *        example:\r\n *          - 'FE'\r\n *          - 'BE'\r\n *      createdAt:\r\n *        type: string\r\n *        description: 생성일\r\n *        format: date-time\r\n *        example: \"2021-01-30T08:30:00Z\"\r\n *      startDate:\r\n *        type: string\r\n *        description: 시작예정일\r\n *        format: date-time\r\n *        example: \"2021-01-30T08:30:00Z\"\r\n *      endDate:\r\n *        type: string\r\n *        description: 모집 마감일\r\n *        format: date-time\r\n *        example: \"2021-01-30T08:30:00Z\"\r\n *      closeDate:\r\n *        type: string\r\n *        description: 마감처리일\r\n *        format: date-time\r\n *        example: \"2021-01-30T08:30:00Z\"\r\n *      deleteDate:\r\n *        type: string\r\n *        description: 삭제일\r\n *        format: date-time\r\n *        example: \"2021-01-30T08:30:00Z\"\r\n *      comments:\r\n *        type: array\r\n *        items:\r\n *          $ref: '#/components/schemas/Comment'\r\n *   Comment:\r\n *     properties:\r\n *      _id:\r\n *        type: string\r\n *        description: 댓글 ID\r\n *        example: '6355eee637ad670014118738'\r\n *      author:\r\n *        type: string\r\n *        description: 작성자 ID\r\n *        example: '63574b3b37ad67001411ba50'\r\n *      content:\r\n *        type: string\r\n *        description: 댓글 내용\r\n *        example: '신청합니다!'\r\n */\r\nexport interface IReplyDocument extends IReply, Document {}\r\n\r\nexport type IReplyModel = Model<IReplyDocument>;\r\n\r\n// 댓글\r\nexport interface IComment {\r\n  content: string;\r\n  author: Types.ObjectId;\r\n  replies: IReplyDocument[] | undefined;\r\n}\r\n\r\nexport interface ICommentDocument extends IComment, Document {}\r\n\r\nexport type ICommentModel = Model<ICommentDocument>;\r\n\r\n// 글\r\nexport interface IPost {\r\n  author: Types.ObjectId; // 글 등록자 정보\r\n  language: string[]; // 사용 언어 리스트\r\n  title: string; // 글 제목\r\n  content: string; // 글 내용\r\n  isDeleted: boolean; // 글 삭제 여부\r\n  isClosed: boolean; // 글 마감 여부\r\n  views: number; // 글 조회수\r\n  comments: ICommentDocument[]; // 글 댓글 정보\r\n  likes: Types.ObjectId[]; // 관심 등록한 사용자 리스트\r\n  totalLikes: number; // 관심 등록 수\r\n  type: string; // 모집 구분(스터디/프로젝트)\r\n  recruits: string; // 모집인원\r\n  onlineOrOffline: string; // 진행방식(온라인/오프라인)\r\n  contactType: string; // 연락방법(오픈 카카오톡, 이메일, 개인 카카오톡)\r\n  contactPoint: string; // 연락 링크\r\n  udemyLecture: string; // udemy 강의\r\n  expectedPeriod: string; // 예상 종료일\r\n  positions: string[]; // 포지션\r\n  createdAt: Date; // 등록일\r\n  startDate: Date; // 시작예정일\r\n  closeDate: Date; // 마감일\r\n  deleteDate: Date; // 삭제일\r\n}\r\nexport interface IPostDocument extends IPost, Document {}\r\n\r\nexport interface IPostModel extends Model<IPostDocument> {\r\n  findPost: (\r\n    offset: number | null,\r\n    limit: number | null,\r\n    sort: string | null,\r\n    language: string | null,\r\n    period: number | null,\r\n    isClosed: string | null,\r\n    type: string | null,\r\n    position: string | null,\r\n  ) => Promise<IPostDocument[]>;\r\n  findPostRecommend: (\r\n    sort: string | null,\r\n    language: string[] | null,\r\n    postId: Types.ObjectId | null,\r\n    userId: Types.ObjectId | null,\r\n    limit: number | null,\r\n  ) => Promise<IPostDocument[]>;\r\n  registerComment: (\r\n    postId: Types.ObjectId,\r\n    content: string,\r\n    author: Types.ObjectId,\r\n  ) => Promise<{ post: IPostDocument; commentId: Types.ObjectId }>;\r\n  registerReply: (\r\n    postId: Types.ObjectId,\r\n    commentId: Types.ObjectId,\r\n    content: string,\r\n    author: Types.ObjectId,\r\n  ) => Promise<{ post: IPostDocument; replyId: Types.ObjectId }>;\r\n  findComments: (id: Types.ObjectId) => Promise<IPostDocument>;\r\n  deletePost: (id: Types.ObjectId) => void;\r\n  modifyPost: (id: Types.ObjectId, post: IPost) => Promise<IPostDocument>;\r\n  modifyComment: (comment: IComment) => Promise<IPostDocument>;\r\n  modifyReply: (comment: IReply) => Promise<IPostDocument>;\r\n  deleteComment: (id: Types.ObjectId) => Promise<IPostDocument>;\r\n  deleteReply: (id: Types.ObjectId) => Promise<IPostDocument>;\r\n  addLike: (postId: Types.ObjectId, userId: Types.ObjectId) => Promise<{ post: IPostDocument; isLikeExist: boolean }>;\r\n  deleteLike: (\r\n    postId: Types.ObjectId,\r\n    userId: Types.ObjectId,\r\n  ) => Promise<{ post: IPostDocument; isLikeExist: boolean }>;\r\n  increaseView: (postId: Types.ObjectId) => void;\r\n  findAuthorByCommentId: (commentId: Types.ObjectId) => Promise<Types.ObjectId | null>;\r\n  findAuthorByReplyId: (replyId: Types.ObjectId) => Promise<Types.ObjectId | null>;\r\n  checkPostAuthorization: (postId: Types.ObjectId, tokenUserId: Types.ObjectId, tokenType: string) => void;\r\n  checkCommentAuthorization: (commentId: Types.ObjectId, tokenUserId: Types.ObjectId, tokenType: string) => void;\r\n  checkReplyAuthorization: (replyId: Types.ObjectId, tokenUserId: Types.ObjectId) => void;\r\n  autoClosing: () => void;\r\n}\r\n\r\n// 대댓글 스키마\r\nconst replySchema = new Schema<IReplyDocument>(\r\n  {\r\n    content: String, // 댓글 내용\r\n    author: { type: Types.ObjectId, ref: 'User', required: true }, // 댓글 등록자 정보\r\n  },\r\n  {\r\n    versionKey: false,\r\n    timestamps: true, // createdAt, updatedAt 컬럼 사용\r\n  },\r\n);\r\n\r\n// 댓글 스키마\r\nconst commentSchema = new Schema<ICommentDocument>(\r\n  {\r\n    content: String, // 댓글 내용\r\n    author: { type: Types.ObjectId, ref: 'User', required: true }, // 댓글 등록자 정보\r\n    replies: [replySchema],\r\n  },\r\n  {\r\n    versionKey: false,\r\n    timestamps: true, // createdAt, updatedAt 컬럼 사용\r\n  },\r\n);\r\n\r\nconst postSchema = new Schema<IPostDocument>(\r\n  {\r\n    author: { type: Types.ObjectId, ref: 'User', required: true }, // 글 등록자 정보\r\n    language: { type: [String], validate: (v: any) => Array.isArray(v) && v.length > 0 }, // 사용 언어 리스트\r\n    title: { type: String, required: true }, // 글 제목\r\n    content: { type: String, required: true }, // 글 내용\r\n    isDeleted: { type: Boolean, default: false }, // 글 삭제 여부\r\n    isClosed: { type: Boolean, default: false }, // 글 마감 여부\r\n    views: { type: Number, default: 0 }, // 글 조회수\r\n    comments: [commentSchema], // 글 댓글 정보\r\n    likes: [{ type: Types.ObjectId, ref: 'User' }], // 관심 등록한 사용자 리스트\r\n    totalLikes: { type: Number, default: 0 }, // 관심 등록 수\r\n    startDate: { type: Date, default: null }, // 시작예정일\r\n    endDate: { type: Date, default: null }, //  진행 종료일\r\n    type: { type: String, default: null }, // 모집 구분(스터디/프로젝트)\r\n    recruits: { type: String, default: null }, // 모집인원\r\n    onlineOrOffline: { type: String, default: null }, // 진행방식(온라인/오프라인)\r\n    contactType: { type: String, default: null }, // 연락방법(오픈 카카오톡, 이메일, 개인 카카오톡)\r\n    contactPoint: { type: String, default: null }, // 연락 링크\r\n    udemyLecture: { type: String, default: null }, // udemy 강의\r\n    expectedPeriod: { type: String, default: null }, // 예상 종료일\r\n    positions: { type: [String] },\r\n    closeDate: { type: Date, default: null }, //  마감일\r\n    deleteDate: { type: Date, default: null }, //  삭제일\r\n  },\r\n  {\r\n    versionKey: false,\r\n    timestamps: true,\r\n    toObject: { virtuals: true },\r\n    toJSON: { virtuals: true },\r\n  },\r\n);\r\n\r\n// 해시태그\r\npostSchema.virtual('hashTag').get(function (this: IPost) {\r\n  const hashTag: Array<string> = [];\r\n  if (this.type && Object.prototype.hasOwnProperty.call(studyOrProjectCode, this.type))\r\n    hashTag.push(studyOrProjectCode[this.type]);\r\n  if (this.onlineOrOffline && Object.prototype.hasOwnProperty.call(onlineOrOfflineCode, this.onlineOrOffline))\r\n    hashTag.push(onlineOrOfflineCode[this.onlineOrOffline]);\r\n  if (this.recruits && this.recruits !== `und` && Object.prototype.hasOwnProperty.call(recruitsCode, this.recruits))\r\n    hashTag.push(recruitsCode[this.recruits]);\r\n  if (\r\n    this.expectedPeriod &&\r\n    this.expectedPeriod !== `und` &&\r\n    Object.prototype.hasOwnProperty.call(expectedPeriodCode, this.expectedPeriod)\r\n  )\r\n    hashTag.push(expectedPeriodCode[this.expectedPeriod]);\r\n  return hashTag;\r\n});\r\n\r\n// 글 상태(뱃지)\r\npostSchema.virtual('state').get(function (this: IPost) {\r\n  let state = '';\r\n  const today: Date = new Date();\r\n  const daysAgo: Date = new Date();\r\n  const millisecondDay: number = 1000 * 60 * 60 * 24;\r\n  daysAgo.setDate(today.getDate() - 3); // 오늘에서 3일전\r\n  // 1. 3일 이내에 등록된 글이면 최신 글\r\n  // 2. 3일 이내 글이면 마감 임박\r\n  // 3. 일 조회수가 50 이상이면 인기\r\n  if (this.createdAt > daysAgo) state = 'new';\r\n  else if (this.startDate > today && (this.startDate.getTime() - today.getTime()) / millisecondDay <= 3)\r\n    state = 'deadline';\r\n  else if (Math.abs(this.views / ((this.createdAt.getTime() - today.getTime()) / millisecondDay)) >= 40) state = 'hot';\r\n  return state;\r\n});\r\n\r\npostSchema.virtual('totalComments').get(function (this: IPost) {\r\n  return this.comments.length;\r\n});\r\n// 최신, 트레딩 조회\r\npostSchema.statics.findPost = async function (offset, limit, sort, language, period, isClosed, type, position) {\r\n  // Pagenation\r\n  const offsetQuery = parseInt(offset, 10) || 0;\r\n  const limitQuery = parseInt(limit, 10) || 20;\r\n\r\n  let sortQuery = [];\r\n  // Sorting\r\n  if (sort) {\r\n    const sortableColumns = ['views', 'createdAt', 'totalLikes'];\r\n    sortQuery = sort.split(',').filter((value: string) => {\r\n      return sortableColumns.indexOf(value.substr(1, value.length)) !== -1 || sortableColumns.indexOf(value) !== -1;\r\n    });\r\n    sortQuery.push('-createdAt');\r\n  } else {\r\n    sortQuery.push('createdAt');\r\n  }\r\n  // Query\r\n  const query: any = {};\r\n  if (typeof language === 'string') query.language = { $in: language.split(',') };\r\n  if (typeof position === 'string') query.positions = { $in: position.split(',') };\r\n\r\n  if (typeof period === 'number' && !Number.isNaN(period)) {\r\n    const today = new Date();\r\n    query.createdAt = { $gte: today.setDate(today.getDate() - period) };\r\n  }\r\n\r\n  // 마감된 글 안보기 기능(false만 지원)\r\n  if (typeof isClosed === 'string' && !(isClosed === 'true')) {\r\n    query.isClosed = { $eq: isClosed === 'true' };\r\n  }\r\n\r\n  // 글 구분(0: 전체, 1: 프로젝트, 2: 스터디)\r\n  if (typeof type === 'string') {\r\n    if (type === '0') query.$or = [{ type: '1' }, { type: '2' }];\r\n    else query.type = { $eq: type };\r\n  }\r\n  const result = await this.find(query)\r\n    .where('isDeleted')\r\n    .equals(false)\r\n    .sort(sortQuery.join(' '))\r\n    .skip(Number(offsetQuery))\r\n    .limit(Number(limitQuery))\r\n    .select(\r\n      `title views comments likes language isClosed totalLikes hashtag startDate endDate type onlineOrOffline contactType recruits expectedPeriod author positions createdAt`,\r\n    )\r\n    .populate('author', 'nickName image');\r\n  return result;\r\n};\r\n// 사용자에게 추천 조회\r\npostSchema.statics.findPostRecommend = async function (sort, language, postId, userId, limit) {\r\n  let sortQuery = [];\r\n  // Sorting\r\n  if (sort) {\r\n    const sortableColumns = ['views', 'createdAt', 'totalLikes'];\r\n    sortQuery = sort.split(',').filter((value: string) => {\r\n      return sortableColumns.indexOf(value.substr(1, value.length)) !== -1 || sortableColumns.indexOf(value) !== -1;\r\n    });\r\n  } else {\r\n    sortQuery.push('createdAt');\r\n  }\r\n  // Query\r\n  const query: any = {};\r\n  if (typeof language === 'object' && language.length > 0) query.language = { $in: language };\r\n\r\n  // 14일 이내 조회\r\n  const today = new Date();\r\n  query.createdAt = { $gte: today.setDate(today.getDate() - 14) };\r\n\r\n  // 현재 읽고 있는 글은 제외하고 조회\r\n  query._id = { $ne: postId };\r\n\r\n  // 사용자가 작성한 글 제외하고 조회\r\n  if (userId) query.author = { $ne: userId };\r\n\r\n  const posts = await this.find(query)\r\n    .where('isDeleted')\r\n    .equals(false)\r\n    .where('isClosed')\r\n    .equals(false)\r\n    .sort(sortQuery.join(' '))\r\n    .limit(limit)\r\n    .select('title')\r\n    .lean();\r\n\r\n  // 부족한 개수만큼 추가 조회\r\n  if (posts.length < limit - 1) {\r\n    const notInPostIdArr = posts.map((post: IPostDocument) => {\r\n      return post._id;\r\n    });\r\n    notInPostIdArr.push(postId);\r\n    query._id = { $nin: notInPostIdArr }; // 이미 조회된 글들은 중복 x\r\n    delete query.language;\r\n    const shortPosts = await this.find(query)\r\n      .where('isDeleted')\r\n      .equals(false)\r\n      .where('isClosed')\r\n      .equals(false)\r\n      .sort(sortQuery.join(' '))\r\n      .limit(limit - posts.length)\r\n      .select('title')\r\n      .lean();\r\n\r\n    posts.push(...shortPosts);\r\n  }\r\n  return posts;\r\n};\r\n\r\npostSchema.statics.registerComment = async function (postId, content, author) {\r\n  const commentId = new Types.ObjectId();\r\n  const post = await this.findOneAndUpdate(\r\n    { _id: postId },\r\n    { $push: { comments: { _id: commentId, content, author } } },\r\n    { new: true, upsert: true },\r\n  );\r\n  return { post, commentId };\r\n};\r\n\r\npostSchema.statics.registerReply = async function (postId, commentId, content, author) {\r\n  const replyId = new Types.ObjectId();\r\n  const post = await this.findOneAndUpdate(\r\n    { _id: postId, comments: { $elemMatch: { _id: commentId } } },\r\n    { $push: { 'comments.$.replies': { _id: replyId, content, author } } },\r\n    { new: true, upsert: true },\r\n  );\r\n  return { post, replyId };\r\n};\r\n\r\npostSchema.statics.findComments = async function (id) {\r\n  const result = await this.findById(id)\r\n    .populate('comments.author', 'nickName image')\r\n    .populate('comments.replies.author', 'nickName image');\r\n  return result;\r\n};\r\n\r\npostSchema.statics.deletePost = async function (id) {\r\n  await this.findOneAndUpdate({ _id: id }, { isDeleted: true, deleteDate: new Date() });\r\n};\r\n\r\npostSchema.statics.modifyPost = async function (id, post) {\r\n  const postRecord = await this.findByIdAndUpdate({ _id: id }, post, {\r\n    new: true,\r\n  });\r\n  return postRecord;\r\n};\r\n\r\n// 댓글 수정\r\npostSchema.statics.modifyComment = async function (comment) {\r\n  const { _id, content } = comment;\r\n  const commentRecord = await this.findOneAndUpdate(\r\n    { comments: { $elemMatch: { _id } } },\r\n    { $set: { 'comments.$.content': content } },\r\n    { new: true },\r\n  );\r\n  return commentRecord;\r\n};\r\n\r\n// 대댓글 수정\r\npostSchema.statics.modifyReply = async function (comment) {\r\n  const { _id, content, commentId } = comment;\r\n  const commentRecord = await this.findOneAndUpdate(\r\n    {\r\n      comments: { $elemMatch: { _id: commentId } },\r\n    },\r\n    {\r\n      $set: { 'comments.$[].replies.$[i].content': content },\r\n    },\r\n    {\r\n      arrayFilters: [{ 'i._id': _id }],\r\n      new: true,\r\n    },\r\n  );\r\n  return commentRecord;\r\n};\r\n\r\npostSchema.statics.deleteComment = async function (id) {\r\n  const commentRecord = await this.findOneAndUpdate(\r\n    { comments: { $elemMatch: { _id: id } } },\r\n    { $pull: { comments: { _id: id } } },\r\n  );\r\n  return commentRecord;\r\n};\r\n\r\npostSchema.statics.deleteReply = async function (id) {\r\n  const commentRecord = await this.findOneAndUpdate(\r\n    { 'comments.replies': { $elemMatch: { _id: id } } },\r\n    { $pull: { 'comments.$.replies': { _id: id } } },\r\n  );\r\n  return commentRecord;\r\n};\r\n\r\n// 관심등록 추가\r\n// 디바운스 실패 경우를 위해 예외처리\r\npostSchema.statics.addLike = async function (postId, userId) {\r\n  const post: IPost[] = await this.find({ _id: postId, likes: { $in: [userId] } });\r\n  const isLikeExist = post.length > 0;\r\n  let result: IPost;\r\n\r\n  if (!isLikeExist) {\r\n    result = await this.findByIdAndUpdate(\r\n      { _id: postId },\r\n      {\r\n        $push: {\r\n          likes: {\r\n            _id: userId,\r\n          },\r\n        },\r\n        $inc: {\r\n          totalLikes: 1,\r\n        },\r\n      },\r\n      {\r\n        new: true,\r\n        upsert: true,\r\n      },\r\n    );\r\n  } else {\r\n    result = post[post.length - 1];\r\n  }\r\n  return { post: result, isLikeExist };\r\n};\r\n\r\npostSchema.statics.deleteLike = async function (postId, userId) {\r\n  const posts = await this.find({ _id: postId });\r\n  let post: IPost | null = posts[posts.length - 1];\r\n  const isLikeExist = post && post.likes.indexOf(userId) > -1;\r\n  if (isLikeExist) {\r\n    post = await this.findOneAndUpdate(\r\n      { _id: postId },\r\n      {\r\n        $pull: { likes: userId },\r\n        $inc: {\r\n          totalLikes: -1,\r\n        },\r\n      },\r\n      {\r\n        new: true,\r\n      },\r\n    );\r\n  }\r\n  return { post, isLikeExist };\r\n};\r\n\r\n// 조회수 증가\r\npostSchema.statics.increaseView = async function (postId) {\r\n  await this.findOneAndUpdate(\r\n    { _id: postId },\r\n    {\r\n      $inc: {\r\n        views: 1,\r\n      },\r\n    },\r\n  );\r\n};\r\n\r\n// 댓글 등록한 사용자 아이디 조회\r\npostSchema.statics.findAuthorByCommentId = async function (commentId) {\r\n  const post = await this.findOne({ comments: { $elemMatch: { _id: commentId } } });\r\n  if (post) {\r\n    const { author } = post.comments[post.comments.length - 1];\r\n    return author;\r\n  }\r\n  return null;\r\n};\r\n\r\n// 대댓글 등록한 사용자 아이디 조회\r\npostSchema.statics.findAuthorByReplyId = async function (replyId) {\r\n  const post = await this.findOne({ 'comments.replies': { $elemMatch: { _id: replyId } } });\r\n  if (post) {\r\n    const { author } = post.comments[post.comments.length - 1];\r\n    return author;\r\n  }\r\n  return null;\r\n};\r\n\r\n// 글 수정 권한 체크\r\npostSchema.statics.checkPostAuthorization = async function (postId, tokenUserId, tokenType) {\r\n  if (tokenType !== 'admin') {\r\n    const post = await this.findOne({ _id: postId, author: tokenUserId });\r\n    if (!post) {\r\n      throw new CustomError('NotAuthenticatedError', 401, 'User does not match');\r\n    }\r\n  }\r\n};\r\n\r\n// 댓글 수정 권한 체크\r\npostSchema.statics.checkCommentAuthorization = async function (commentId, tokenUserId, tokenType) {\r\n  if (tokenType !== 'admin') {\r\n    const post = await this.findOne({ comments: { $elemMatch: { _id: commentId, author: tokenUserId } } });\r\n    if (!post) {\r\n      throw new CustomError('NotAuthenticatedError', 401, 'User does not match');\r\n    }\r\n  }\r\n};\r\n\r\n// 대댓글 수정 권한 체크\r\npostSchema.statics.checkReplyAuthorization = async function (replyId, tokenUserId) {\r\n  const post = await this.findOne({ 'comments.replies': { $elemMatch: { _id: replyId, author: tokenUserId } } });\r\n  if (!post) {\r\n    throw new CustomError('NotAuthenticatedError', 401, 'User does not match');\r\n  }\r\n};\r\n\r\n// 글 자동 마감\r\npostSchema.statics.autoClosing = async function () {\r\n  const today = new Date();\r\n  await this.updateMany(\r\n    { $and: [{ isClosed: false }, { endDate: { $ne: null } }, { endDate: { $lte: today } }] },\r\n    { isClosed: true },\r\n  );\r\n};\r\n\r\nconst Post = model<IPostDocument, IPostModel>('Post', postSchema);\r\n\r\nexport { Post };\r\n"]}