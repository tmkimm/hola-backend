{"version":3,"file":"dashboard.js","sourceRoot":"/","sources":["services/dashboard.ts"],"names":[],"mappings":"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","sourcesContent":["import { User } from '../models/User';\nimport { Post } from '../models/Post';\n\nimport { SignOutUser } from '../models/SignOutUser';\nimport { PostFilterLog } from '../models/PostFilterLog';\n\nexport class DashboardService {\n  // 데일리 액션) 현재 총 회원 수, 오늘 가입자, 오늘 탈퇴자\n  async findDailyUser() {\n    const totalUser: number = await User.countDocuments();\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const signUpCount: number = await User.countDocuments({ createdAt: { $gte: today } });\n    const signOutCount: number = await SignOutUser.countDocuments({ signOutDate: { $gte: today } });\n\n    return {\n      totalUser,\n      signUpCount,\n      signOutCount,\n    };\n  }\n\n  // 일자별 회원 가입 현황(일자 / 신규 가입자 / 탈퇴자)\n  async findUserHistory(startDate: string, endDate: string) {\n    const userHistory = await User.aggregate([\n      { $match: { createdAt: { $gte: new Date(startDate), $lte: new Date(endDate) } } },\n      { $group: { _id: { $dateToString: { format: '%Y-%m-%d', date: '$createdAt' } }, signIn: { $sum: 1 } } },\n      { $addFields: { signOut: 0 } },\n      {\n        $unionWith: {\n          coll: 'signoutusers',\n          pipeline: [\n            { $match: { signOutDate: { $gte: new Date(startDate), $lte: new Date(endDate) } } },\n            { $group: { _id: { $dateToString: { format: '%Y-%m-%d', date: '$signOutDate' } }, signOut: { $sum: 1 } } },\n            { $addFields: { signIn: 0 } },\n          ],\n        },\n      },\n      { $group: { _id: '$_id', signIn: { $sum: '$signIn' }, signOut: { $sum: '$signOut' } } },\n      { $sort: { _id: 1 } },\n    ]);\n    return userHistory;\n  }\n\n  // 게시글 데일리(오늘 전체 글 조회 수, 등록된 글, 글 마감 수, 글 삭제 수 )\n  async findDailyPost() {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    let totalView = 0;\n    const totalViewSum = await Post.aggregate([\n      { $match: { createdAt: { $gte: today } } },\n      { $group: { _id: null, totalView: { $sum: '$views' } } },\n    ]);\n    if (totalViewSum && totalViewSum.length > 0 && totalViewSum[0].totalView) totalView = totalViewSum[0].totalView;\n    return {\n      totalView,\n    };\n  }\n\n  // 일자별 게시글 현황(일자 / 등록된 글 / 마감된 글 / 삭제된 글)\n  async findPostHistory(startDate: string, endDate: string) {\n    const postHistory = await Post.aggregate([\n      { $match: { createdAt: { $gte: new Date(startDate), $lte: new Date(endDate) } } },\n      { $group: { _id: { $dateToString: { format: '%Y-%m-%d', date: '$createdAt' } }, new: { $sum: 1 } } },\n      {\n        $unionWith: {\n          coll: 'posts',\n          pipeline: [\n            { $match: { closeDate: { $gte: new Date(startDate), $lte: new Date(endDate) } } },\n            { $group: { _id: { $dateToString: { format: '%Y-%m-%d', date: '$closeDate' } }, closed: { $sum: 1 } } },\n          ],\n        },\n      },\n      {\n        $unionWith: {\n          coll: 'posts',\n          pipeline: [\n            { $match: { deleteDate: { $gte: new Date(startDate), $lte: new Date(endDate) } } },\n            { $group: { _id: { $dateToString: { format: '%Y-%m-%d', date: '$deleteDate' } }, deleted: { $sum: 1 } } },\n          ],\n        },\n      },\n      { $group: { _id: '$_id', new: { $sum: '$new' }, closed: { $sum: '$closed' }, deleted: { $sum: '$deleted' } } },\n      { $sort: { _id: 1 } },\n    ]);\n    return postHistory;\n  }\n\n  // 가장 많이 조회해 본 언어 필터\n  async findPostFilterRank(startDate: string, endDate: string) {\n    const userHistory = await PostFilterLog.aggregate([\n      { $match: { viewDate: { $gte: new Date(startDate), $lte: new Date(endDate) } } },\n      { $project: { _id: 0, viewDate: 1, language: 1 } },\n      { $unwind: '$language' },\n      { $group: { _id: '$language', cnt: { $sum: 1 } } },\n      { $sort: { cnt: 1 } },\n    ]);\n    return userHistory;\n  }\n}\n"]}