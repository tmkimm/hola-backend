{"version":3,"file":"dashboard.js","sourceRoot":"/","sources":["services/dashboard.ts"],"names":[],"mappings":"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","sourcesContent":["import { User } from '../models/User';\nimport { SignOutUser } from '../models/SignOutUser';\nimport { PostFilterLog } from '../models/PostFilterLog';\n\nexport class DashboardService {\n  // 데일리 액션) 현재 총 회원 수, 오늘 가입자, 오늘 탈퇴자\n  async findDailyUser() {\n    const totalUser: number = await User.countDocuments();\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const signUpCount: number = await User.countDocuments({ createdAt: { $gte: today } });\n    const signOutCount: number = await SignOutUser.countDocuments({ signOutDate: { $gte: today } });\n\n    return {\n      totalUser,\n      signUpCount,\n      signOutCount,\n    };\n  }\n\n  // 일자별 회원 가입 현황(일자 / 신규 가입자 / 탈퇴자)\n  async findUserHistory() {\n    const today = new Date('09/01/2022');\n\n    const userHistory = await User.aggregate([\n      { $match: { createdAt: { $gte: today } } },\n      { $group: { _id: { $dateToString: { format: '%Y-%m-%d', date: '$createdAt' } }, signIn: { $sum: 1 } } },\n      { $addFields: { signOut: 0 } },\n      {\n        $unionWith: {\n          coll: 'signoutusers',\n          pipeline: [\n            { $match: { signOutDate: { $gte: today } } },\n            { $group: { _id: { $dateToString: { format: '%Y-%m-%d', date: '$signOutDate' } }, signOut: { $sum: 1 } } },\n            { $addFields: { signIn: 0 } },\n          ],\n        },\n      },\n      { $group: { _id: '$_id', signIn: { $sum: '$signIn' }, signOut: { $sum: '$signOut' } } },\n      { $sort: { _id: 1 } },\n    ]);\n    return userHistory;\n  }\n\n  // { $project : { _id: 0, viewDate: 1, language: 1}},\n  // { $unwind : \"$language\"},\n  // { $group: { _id: \"$language\", cnt: { $sum : 1}}},\n  // { $sort : {cnt: 1}}\n\n  // 가장 많이 조회해 본 언어 필터\n  async findPostFilterRank() {\n    const today = new Date('09/01/2022');\n\n    const userHistory = await PostFilterLog.aggregate([\n      { $match: { viewDate: { $gte: today } } },\n      { $project: { _id: 0, viewDate: 1, language: 1 } },\n      { $unwind: '$language' },\n      { $group: { _id: '$language', cnt: { $sum: 1 } } },\n      { $sort: { cnt: 1 } },\n    ]);\n    return userHistory;\n  }\n}\n"]}